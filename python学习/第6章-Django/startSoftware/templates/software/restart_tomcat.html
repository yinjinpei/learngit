{% extends 'software_base.html' %}
{% load staticfiles %}
{% block title %}CMDB系统{% endblock %}

{% block scripts %}
    <link href="{% static 'css/chosen.min.css' %}" rel="stylesheet">
    <!--<script src="/static/js/jquery-3.3.1.js"></script>-->
    <script src="js/jquery-3.5.1.min.js"></script>
    <script src='js/chosen.jquery.js'></script>
    <script type="text/javascript">
        $(function () {
            $('#backup_all').click(function () {
                var socket = new WebSocket("ws://" + window.location.host + "/restart_tomcat");
                console.log(socket);
                socket.onopen = function () {
                    console.log('WebSocket open');//成功连接上Websocket
                    socket.send($('#backup_all').val());//发送数据到服务端
                };
                socket.onmessage = function (e) {
                    console.log('message: ' + e.data);//打印服务端返回的数据
                    $('#messagecontainer').append(e.data+'<br/>');
                };
            });

            $('.chosen').chosen({
                no_results_text: "没有找到结果！",//搜索无结果时显示的提示
                search_contains:true,   //关键字模糊搜索。设置为true，只要选项包含搜索词就会显示；设置为false，则要求从选项开头开始匹配
                allow_single_deselect:true, //单选下拉框是否允许取消选择。如果允许，选中选项会有一个x号可以删除选项
                disable_search: false, //禁用搜索。设置为true，则无法搜索选项。
                disable_search_threshold: 0, //当选项少等于于指定个数时禁用搜索。
                inherit_select_classes: true, //是否继承原下拉框的样式类，此处设为继承
                placeholder_text_single: '选择国家', //单选选择框的默认提示信息，当选项为空时会显示。如果原下拉框设置了data-placeholder，会覆盖这里的值。
                width: '400px', //设置chosen下拉框的宽度。即使原下拉框本身设置了宽度，也会被width覆盖。
                max_shown_results: 1000, //下拉框最大显示选项数量
                display_disabled_options: false,
                single_backstroke_delete: false, //false表示按两次删除键才能删除选项，true表示按一次删除键即可删除
                case_sensitive_search: false, //搜索大小写敏感。此处设为不敏感
                group_search: false, //选项组是否可搜。此处搜索不可搜
                include_group_label_in_selected: false //选中选项是否显示选项分组。false不显示，true显示。默认false。
            });

            $('.chosen2').chosen({
                search_contains:false,
                enable_split_word_search: true //分词搜索，选项词可通过空格或'[]'分隔。search_contains为false时才能看出效果
            });
    });


    </script>
{% endblock %}

{% block content %}
    <style type="text/css">
        #backup_all{
            background-color: green;
        }
        #messagecontainer{
            margin: 20px;
        }
        .form-group{
            width: 15%;
        }
        .form-login{
            font-size: 18px;
            font-weight: bold;
            color: #0b97c4;
            text-align: center;
        }
        .w-country{width:100px;}
    </style>
<div class="container">

    {% if manager_islogin != True %}
        {% if first_login == True %}
            <div class="form-group">
                <form class='form-login' action="restart_tomcat" method="post">
                    {% csrf_token %}
                    {{setpassword.password1.label}}
                    {{setpassword.password1}}
                    {{setpassword.password2.label}}
                    {{setpassword.password2}}
                    <br>
                    <button type="reset" class="btn btn-default pull-left">重置</button>
                    <button type="submit" class="btn btn-primary pull-right">提交</button>
                </form>
            </div>
        {% else %}
            <div class="form-group" id="form-group">
                <form class='form-login' action="restart_tomcat" method="post">
                    {% csrf_token %}
                    {{manager.password.label}}
                    {{manager.password}}
                    <br>
                    <button type="reset" class="btn btn-default pull-left">重置</button>
                    <button type="submit" class="btn btn-primary pull-right">提交</button>
                </form>
            </div>
        {% endif %}
    {% else %}
        <form class='form-login' method="post">
            {% csrf_token %}
            <select class='chosen w-country' data-placeholder='请选择国家' multiple >
              <optgroup label="Swedish Cars">
              <option value=""></option>
              <option value="China">中国</option>
              </optgroup>
              <optgroup label="Swedish Cars">
              <option value="US">US</option>
              <option value="England">英国</option>
              </optgroup>
              <optgroup label="Swedish Cars">
              <option value="Canada">加拿大</option>
              <option value="Cube">古巴</option>
              </optgroup>
            </select>

            <br/><br/>
            <select class='chosen'>
              <optgroup label="Swedish Cars">
                <option value ="volvo">Volvo</option>
                <option value ="saab">Saab</option>
              </optgroup>
              <optgroup label="German Cars">
                <option value ="mercedes">Mercedes</option>
                <option value ="audi">Audi</option>
              </optgroup>
            </select>

            <br/><br/>
            <select class='chosen2' >
              <option value=""></option>
              <option value="vegetable">西红柿 黄瓜 芹菜</option>
              <option value="fruit">葡萄 草莓 芭乐[潘石榴]</option>
            </select>

        <button type="button" class="btn btn-primary" id="backup_all" value="backup_all">
            执行Shell脚本
        </button>

        </form>


        <h3 style="margin: 20px;">脚本执行结果:</h3>
        <div id="messagecontainer">
        </div>
    {% endif %}
    <br><br><br><hr>
    <a class="btn btn-primary pull-left" id="link_index" href="/">返回首页</a>
    <br><br><br><br>
    <a class="btn btn-primary pull-left" id="link_top" href="#">回到顶部</a>
    <br><br><br><br>
</div>
{% endblock %}
